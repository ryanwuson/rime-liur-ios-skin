# 蝦米鍵盤增強計畫

## 最新更新 (2025-02-02)

### 字體顏色與字號系統完善 - 第三次修正（重要色值修正）
- ✅ **修正滑動提示文字色值錯誤**：根據參考主題「蝦米：慣用右手(空白增大)」的實際 YAML 檔案，修正滑動提示文字色值
  - 亮色主題：從 `#666666` 修正為 `#00000055`（黑色55%透明度）
  - 暗色主題：從 `#CCCCCC` 修正為 `#FFFFFF55`（白色55%透明度）
- ✅ **修正數字鍵盤字號錯誤**：根據參考主題實際數值，數字鍵盤字號從 20pt 修正為 24pt
- ✅ **驗證其他字號數值正確性**：確認以下字號與參考主題一致
  - 主要按鍵文字（字母鍵）：21pt ✓
  - 英文鍵盤小寫字母：23pt ✓  
  - 系統功能鍵（返回、選定等）：16pt ✓
- ✅ **更新配色映射說明**：在 Settings.libsonnet 中添加具體數值說明，標註已修正的項目

### 字體顏色與字號系統完善 - 第二次修正
- ✅ **修正預設字號數值錯誤**：根據原版「蝦米輸入法」主題，修正 Settings.libsonnet 中的預設字號數值
  - 滑動提示文字：從 12pt 修正為 8pt
  - 主要文字（字母鍵、數字鍵）：從 18pt 修正為 21pt  
  - 數字鍵盤數字：從 24pt 修正為 20pt
  - **工具列文字字號：從 16pt 修正為 20pt**（感謝用戶指正，實際檢查「蝦米：慣用右手(空白增大)」主題確認為 20pt）
- ✅ **修正空白鍵文字配色邏輯**：空白鍵提示文字（「蝦米輸入法」、「Easy English」、「English」）現在正確使用 `keyText.primary`（主要文字色）而非 `keyText.secondary`
- ✅ **更新配色映射說明**：修正 Settings.libsonnet 和 color.libsonnet 中的配色映射說明，反映實際的配色邏輯
- ✅ **確保系統功能鍵配色正確**：驗證所有系統功能鍵（shift、delete、123、同音、選定、搜尋、返回、換行、鎖定、上下翻頁等）正確使用 `systemKeyText.normal`
- ✅ **確保數字鍵盤符號區配色正確**：驗證數字鍵盤符號區（@%-+）正確使用 `keyText.primary`

### 字體顏色與字號系統完善 - 第一次實作
- ✅ **修正數字鍵盤符號區配色問題**：數字鍵盤符號區（@%-+）現在正確使用主要按鍵文字色（`keyText.primary`），修改此配色即可改變符號區顏色
- ✅ **修正工具列字號預設值**：工具列文字字號預設值從 20pt 修正為 16pt，符合原版主題規格
- ✅ **修正空白鍵配色不一致問題**：中文鍵盤的「蝦米輸入法」、「Easy English」現在正確使用 `keyText.secondary`，與英文鍵盤的「English」保持一致
- ✅ **修正系統功能鍵配色問題**：所有系統功能鍵（shift、delete、123、同音、選定、搜尋、返回、換行、鎖定、上下翻頁等）現在正確使用 `systemKeyText.normal` 而非 `keyText.primary`
- ✅ **完善配色映射說明**：在 Settings.libsonnet 中添加詳細的配色映射說明，讓用戶清楚了解每種配色的作用範圍
- ✅ **移除無用配置項目**：移除不實際使用的 `toolbar.buttonColor` 和 `symbolic.unselectedText` 配置

---

## 專案概述
將「蝦米輸入法」鍵盤皮膚升級為具備完整自訂配色功能和字體配色系統的進階版本。

## 目標功能
1. **完全自訂工具列系統** - 支援10個按鈕的完全自訂工具列（包含面板和收折按鈕）
2. **完整自訂配色系統** - 使用者可在 Settings.libsonnet 自訂所有顏色和字體
3. **字體顏色與字號系統** - 支援滑動提示、按鍵文字、系統功能鍵、數字鍵、工具列的字體配色與字號
4. **上下滑動提示控制** - 可開關上下滑動提示顯示
5. **空白佔位符系統** - 精確控制按鈕對齊位置

---

## 實作階段規劃

### 🟢 階段1：基礎設定系統 (優先度：最高) ✅ **已完成**
**目標：** 建立 Settings.libsonnet 基礎架構和進階分行控制
**預估時間：** 1-2小時
**風險：** 低

#### 任務清單：
- [x] 1.1 創建 Settings.libsonnet 檔案
- [x] 1.2 加入滑動提示控制設定
- [x] 1.3 加入工具列按鈕配置設定
- [x] 1.4 加入滑動區域寬度設定
- [x] 1.5 測試基礎設定讀取功能
- [x] 1.6 修復滑動提示控制功能
- [x] 1.7 **實作進階分行控制系統**
- [x] 1.8 **🆕 精細化滑動控制系統**

#### 檔案異動：
- 新增：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/Settings.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/toolbar.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/swipeStyles.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/keyboard/pinyin_26.jsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/keyboard/alphabetic_26.jsonnet`

#### 設定內容：
```jsonnet
{
  # ===== 全域控制設定（90% 用戶只需要這些）=====
  
  # 滑動功能精細化控制
  enableSwipeUpActions: true,    // 控制上滑動作
  enableSwipeDownActions: true,  // 控制下滑動作
  enableLongPressActions: true,  // 控制長按動作
  
  # 滑動提示文字顯示
  showSwipeUpText: true,         // 顯示上滑提示文字
  showSwipeDownText: true,       // 顯示下滑提示文字

  # ===== 進階分行控制（進階用戶專用）=====
  # 分行設定會覆蓋全域設定
  # Row1: Q W E R T Y U I O P (10個鍵)
  # Row2: A S D F G H J K L (9個鍵) 
  # Row3: Z X C V B N M (7個鍵)
  # Row4: 逗號、句號 (2個鍵，僅支援長按控制)
  advancedRowControl: {
    row1: { 
      // 完整的 5 個設定選項
      // enableSwipeUpActions: false,   // 關閉上滑動作
      // enableSwipeDownActions: true,  // 保留下滑動作
      // enableLongPressActions: true,  // 保留長按功能
      // showSwipeUpText: false,        // 隱藏上滑文字
      // showSwipeDownText: true,       // 顯示下滑文字
    },
    row2: { /* 同 row1 的完整選項 */ },
    row3: { /* 同 row1 的完整選項 */ },
    row4: { 
      // 僅長按控制（逗號句號沒有滑動功能）
      // enableLongPressActions: false, // 關閉長按功能
    },
  },

  # 工具列按鈕配置 (0=空白佔位)
  toolbarSlideButtons: [0, 0, 4, 5, 6, 7, 8, 9],

  # 滑動區域寬度
  toolbarSlideButtonsMaxCount: {
    portrait: 8,
    landscape: 10,
  },
}
```

#### 🆕 **進階分行控制系統**：
**核心功能**：
- **分行架構**: 28個按鍵分為4行（26個字母 + 2個標點）
- **優先級邏輯**: 分行設定自動覆蓋全域設定
- **統一介面**: `getEffectiveSetting(key, settingName)` 函數處理所有設定查詢

**技術實現**：
```jsonnet
// 獲取按鍵所屬的行
local getKeyRow = function(key)
  if std.member(['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'], key) then 'row1'
  else if std.member(['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'], key) then 'row2'
  else if std.member(['z', 'x', 'c', 'v', 'b', 'n', 'm'], key) then 'row3'
  else if std.member([',', '.'], key) then 'row4'
  else null;

// 獲取有效設定值（核心邏輯：分行設定覆蓋全域設定）
local getEffectiveSetting = function(key, settingName)
  local rowName = getKeyRow(key);
  if rowName == null then settings[settingName] else
  local rowSettings = std.get(settings.advancedRowControl, rowName, {});
  // 優先級：分行設定 > 全域設定
  if std.objectHas(rowSettings, settingName) then
    rowSettings[settingName]  // 使用分行設定
  else
    settings[settingName];    // 使用全域設定
```

**使用範例**：
```jsonnet
# 範例1：第一行關閉上滑文字
advancedRowControl: {
  row1: { showSwipeUpText: false }
}

# 範例2：第三行關閉所有滑動功能  
advancedRowControl: {
  row3: { enableSwipeActions: false }
}

# 範例3：全域關閉，但第二行保留
enableSwipeActions: false,
advancedRowControl: {
  row2: { enableSwipeActions: true }
}
```

#### 修復詳情：
**問題**：滑動提示控制不工作，滑動氣泡顯示錯誤內容
**根本原因**：
1. 蝦米架構與空山素影不同，需要在多個地方檢查設定
2. 滑動氣泡樣式生成被按鈕文字設定影響，導致氣泡無法正確顯示滑動目標字符

**解決方案**：
- 修改滑動樣式生成邏輯，在生成前檢查設定
- 修改按鈕前景樣式列表生成邏輯，避免引用不存在的樣式
- 添加必要的 settings 導入
- **關鍵修復**：將滑動氣泡樣式生成與按鈕文字設定分離
  - `makeSwipeUpHintForegroundStyle` 和 `makeSwipeDownHintForegroundStyle` 總是生成氣泡樣式
  - `createHintStyle` 總是包含滑動氣泡樣式引用
  - 按鈕文字顯示由 `makeForegroundStyle` 控制，氣泡顯示獨立運作

#### 🆕 **精細化滑動控制系統**：

**核心突破**：
- **獨立上下滑控制**: `enableSwipeUpActions` + `enableSwipeDownActions` 取代粗糙的 `enableSwipeActions`
- **精確氣泡控制**: 上滑氣泡和下滑氣泡根據對應的動作設定獨立顯示
- **長按功能修復**: 逗號句號的長按選單正確響應 `enableLongPressActions` 設定

**技術實現核心**：
```jsonnet
// 精細化滑動控制應用
[if std.objectHas(swipe_up, key) && getEffectiveSetting(key, 'enableSwipeUpActions') then 'swipeUpAction']: swipe_up[key].action,
[if std.objectHas(swipe_down, key) && getEffectiveSetting(key, 'enableSwipeDownActions') then 'swipeDownAction']: swipe_down[key].action,

// 長按功能條件式啟用
[if isLetter && std.objectHas(hintSymbolsData_pinyin, key) && getEffectiveSetting(key, 'enableLongPressActions') then 'hintSymbolsStyle']: key + 'ButtonHintSymbolsStyle',

// 逗號句號長按控制
[if swipeStyles.getEffectiveSetting(',', 'enableLongPressActions') then 'hintSymbolsStyle']: 'commaButtonHintSymbolsStyle',

// 獨立氣泡樣式生成
local makeSwipeUpHintForegroundStyle = function(key, direction, theme, type, data)
  if !getEffectiveSetting(key, 'enableSwipeUpActions') then {} else
  // 氣泡樣式生成邏輯...

local makeSwipeDownHintForegroundStyle = function(key, direction, theme, type, data)
  if !getEffectiveSetting(key, 'enableSwipeDownActions') then {} else
  // 氣泡樣式生成邏輯...
```

**🎯 實際使用場景範例**：

**場景1：第一行精細控制**
```jsonnet
row1: { 
  enableSwipeUpActions: false,   // 上滑動作關閉
  enableSwipeDownActions: true,  // 下滑動作保留
  showSwipeUpText: false,        // 上滑文字隱藏
  showSwipeDownText: true,       // 下滑文字顯示
}
// 結果：Q-P 行只有下滑功能，上滑完全禁用
```

**場景2：全域關閉長按，特定行保留**
```jsonnet
enableLongPressActions: false,  // 全域關閉長按
advancedRowControl: {
  row2: { enableLongPressActions: true },  // 第二行保留長按
  row4: { enableLongPressActions: true },  // 逗號句號保留長按
}
// 結果：只有 A-L 行和逗號句號有長按功能
```

**場景3：漸進式功能分佈**
```jsonnet
row1: { enableSwipeUpActions: false },      // 第一行無上滑
row2: { enableLongPressActions: false },    // 第二行無長按
row3: { 
  showSwipeUpText: false,                   // 第三行隱藏上滑文字
  showSwipeDownText: false,                 // 第三行隱藏下滑文字
},
row4: { enableLongPressActions: false },    // 逗號句號無長按
// 結果：每行都有不同的功能配置
```

**🔧 關鍵問題解決過程**：

**問題1：滑動氣泡邏輯錯誤**
- **現象**: `enableSwipeActions: false` 時滑動動作被禁用，但滑動氣泡仍然顯示
- **根因**: 滑動氣泡樣式生成沒有檢查動作設定
- **解決**: 修改 `makeSwipeUpHintForegroundStyle` 和 `makeSwipeDownHintForegroundStyle` 函數，加入動作設定檢查

**問題2：控制粒度不夠精細**
- **現象**: 用戶想要「上滑關閉，下滑保留」但 `enableSwipeActions` 是全域開關
- **根因**: 設計時沒有考慮到上下滑的獨立控制需求
- **解決**: 拆分為 `enableSwipeUpActions` 和 `enableSwipeDownActions` 兩個獨立設定

**問題3：逗號句號長按功能未正確禁用**
- **現象**: 全域 `enableLongPressActions: false` 時，逗號句號長按選單仍然出現
- **根因**: 逗號句號按鍵定義中直接指定了 `hintSymbolsStyle`，沒有檢查設定
- **解決**: 改為條件式添加：`[if getEffectiveSetting(',', 'enableLongPressActions') then 'hintSymbolsStyle']`

**問題4：設定範例不完整**
- **現象**: row1 有完整範例，但 row2、row3 範例不一致，row4 包含不適用的設定
- **根因**: 初期設計時沒有統一規劃各行的適用設定
- **解決**: 統一 row1-3 的 5 個設定選項，row4 僅保留長按控制

#### 驗收標準：
- [x] Settings.libsonnet 可被正確讀取
- [x] 設定值可在 toolbar.libsonnet 中正確引用
- [x] 編譯無錯誤
- [x] 滑動提示控制功能正常工作
- [x] showSwipeUpText: true → 上滑樣式正確生成
- [x] showSwipeDownText: false → 下滑樣式正確隱藏
- [x] **滑動氣泡功能修復** → 滑動時氣泡顯示正確的滑動目標字符（如 U 下滑顯示 "7"）
- [x] **🆕 進階分行控制** → 分行設定正確覆蓋全域設定
- [x] **🆕 核心函數** → `getEffectiveSetting` 函數正確處理優先級邏輯
- [x] **🆕 精細化滑動控制** → 上下滑動作可以獨立控制
- [x] **🆕 長按功能修復** → 逗號句號長按正確響應設定
- [x] **🆕 編譯測試** → 24個 YAML 檔案全部成功生成

#### 🏆 **成果總結**：
- **控制精度**: 從 3 個粗糙設定提升到 5 個精細設定
- **控制範圍**: 28 個按鍵（26 字母 + 2 標點）分 4 行獨立控制
- **用戶體驗**: 90% 用戶使用簡單全域設定，10% 進階用戶享受精細控制
- **技術架構**: 統一的 `getEffectiveSetting` 函數處理所有設定查詢
- **向後兼容**: 完全保持原有功能，新增功能不影響現有用戶
- [x] Settings.libsonnet 可被正確讀取
- [x] 設定值可在 toolbar.libsonnet 中正確引用
- [x] 編譯無錯誤
- [x] 滑動提示控制功能正常工作
- [x] showSwipeUpText: true → 上滑樣式正確生成
- [x] showSwipeDownText: false → 下滑樣式正確隱藏
- [x] **滑動氣泡功能修復** → 滑動時氣泡顯示正確的滑動目標字符（如 U 下滑顯示 "7"）
- [x] **🆕 進階分行控制** → 分行設定正確覆蓋全域設定
- [x] **🆕 核心函數** → `getEffectiveSetting` 函數正確處理優先級邏輯
- [x] **🆕 編譯測試** → 24個 YAML 檔案全部成功生成

---

### 🟢 階段2：完全自訂工具列系統 (優先度：高) ✅ **已完成**
**目標：** 實作完全自訂的10按鈕工具列系統（包含面板和收折按鈕）
**預估時間：** 2-3小時
**風險：** 中等

#### 任務清單：
- [x] 2.1 建立完整按鈕編號對應系統（包含面板和收折）
- [x] 2.2 移除滑動相關設定，改為固定10按鈕系統
- [x] 2.3 實作完全自訂按鈕生成函數
- [x] 2.4 修改工具列佈局為純 HStack 系統
- [x] 2.5 支援空白佔位符功能
- [x] 2.6 **🆕 讓面板和收折按鈕也可自訂位置**
- [x] 2.7 **🆕 支援最多10個空白佔位符**

#### 檔案異動：
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/toolbar.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/Settings.libsonnet`

#### 🎯 **最終技術方案**：

**核心設計理念**：
- **完全自訂**：用戶可以完全控制10個按鈕的位置，包括面板和收折按鈕
- **簡單實用**：放棄複雜的滑動功能，專注於實用的固定佈局
- **靈活配置**：通過簡單的數字陣列即可調整所有按鈕位置

**按鈕編號系統**：
```jsonnet
# 按鈕編號對應表：
# 0: 空白佔位符
# 1: 面板按鈕 (面)
# 2: 收折按鈕 (收)
# 4: 中英切換 (英)
# 5: 簡繁切換 (簡)  
# 6: 愛心按鈕 (♥)
# 7: 剪貼本按鈕 (剪)
# 8: 符號鍵盤 (符)
# 9: Emoji鍵盤 (😊)

# 完全自訂10個按鈕位置
toolbarButtons: [1, 0, 0, 4, 5, 6, 7, 0, 0, 2],
# 結果：[面] [空 空 英 简 ♥ 剪 空 空] [收]
```

**技術實現架構**：
```jsonnet
// 1. 完整按鈕映射（包含面板和收折）
local buttonMap = {
  '0': null,                     // 空白佔位符
  '1': 'toolbarPanelButton',     // 面板按鈕
  '2': 'toolbarCloseButton',     // 收折按鈕
  '4': 'toolbarChEnButton',      // 中英切換
  '5': 'toolbarSimp2TradButton', // 簡繁切換
  '6': 'toolbarHeartButton',     // 愛心按鈕
  '7': 'toolbarClipboardButton', // 剪貼本按鈕
  '8': 'toolbarSymbolButton',    // 符號鍵盤
  '9': 'toolbarEmojiButton',     // Emoji鍵盤
};

// 2. 動態按鈕生成（HStack 系統）
local generateToolbarButtons = function()
  std.foldl(
    function(acc, buttonCode)
      if buttonCode == 0 then
        // 添加空白佔位符
        { cells: acc.cells + [{ Cell: 'toolbarSpacer' + (acc.spacerCount + 1) + 'Button' }], spacerCount: acc.spacerCount + 1 }
      else if std.objectHas(buttonMap, buttonCodeStr) && buttonMap[buttonCodeStr] != null then
        // 添加對應按鈕
        { cells: acc.cells + [{ Cell: buttonMap[buttonCodeStr] }], spacerCount: acc.spacerCount }
      else
        // 未知編號，添加空白佔位符
        { cells: acc.cells + [{ Cell: 'toolbarSpacer' + (acc.spacerCount + 1) + 'Button' }], spacerCount: acc.spacerCount + 1 },
    settings.toolbarButtons,
    { cells: [], spacerCount: 0 }
  ).cells;

// 3. 純 HStack 佈局
toolbarLayout: [
  {
    HStack: {
      subviews: generateToolbarButtons(),
    },
  },
],
```

#### 🏆 **最終成果**：

**功能完整性**：
- ✅ **完全自訂**：10個按鈕位置完全由用戶控制
- ✅ **包含面板收折**：面板和收折按鈕也可以自由放置
- ✅ **空白佔位符**：支援最多10個空白佔位符
- ✅ **狀態切換**：中英切換和簡繁切換按鈕正確顯示狀態
- ✅ **簡單配置**：通過數字陣列即可調整所有按鈕

**用戶體驗**：
- **極度靈活**：可以將面板放在任何位置，收折放在任何位置
- **直觀配置**：`[1, 0, 0, 4, 5, 6, 7, 0, 0, 2]` 直接對應按鈕位置
- **無學習成本**：不需要理解複雜的滑動邏輯
- **穩定可靠**：基於成熟的 HStack 系統，不會有滑動相關的問題

**配置範例**：
```jsonnet
# 範例1：傳統佈局（面板在左，收折在右）
toolbarButtons: [1, 0, 4, 5, 6, 7, 8, 9, 0, 2],
# 結果：[面] [空 英 简 ♥ 剪 符 😊 空] [收]

# 範例2：面板在右側
toolbarButtons: [0, 0, 4, 5, 6, 7, 8, 9, 1, 2],
# 結果：[空 空 英 简 ♥ 剪 符 😊] [面] [收]

# 範例3：收折在中間
toolbarButtons: [1, 0, 4, 5, 2, 6, 7, 8, 9, 0],
# 結果：[面] [空 英 简] [收] [♥ 剪 符 😊 空]

# 範例4：極簡佈局
toolbarButtons: [1, 4, 5, 0, 0, 0, 0, 0, 0, 2],
# 結果：[面] [英 简 空 空 空 空 空 空] [收]
```

#### 驗收標準：
- [x] 編譯無語法錯誤
- [x] 24個 YAML 檔案全部成功生成
- [x] 工具列顯示10個按鈕位置
- [x] 面板和收折按鈕可以自由放置
- [x] 空白佔位符正確顯示
- [x] 中英切換按鈕狀態正確（英↔中）
- [x] 簡繁切換按鈕狀態正確（简↔繁）
- [x] 所有按鈕功能保持正常

#### 🎯 **解決方案優勢**：

**相比滑動系統的優勢**：
1. **穩定性**：基於成熟的 HStack 系統，不會有滑動相關的 bug
2. **簡單性**：配置直觀，不需要理解複雜的滑動邏輯
3. **完全控制**：包括面板和收折在內的所有按鈕都可以自由放置
4. **無限制**：不受滑動區域大小限制，10個位置完全自由

**實用性考量**：
- **10個按鈕足夠**：對大多數用戶來說，10個按鈕已經足夠使用
- **視覺清晰**：固定佈局比滑動佈局更容易記憶和使用
- **性能更好**：HStack 系統比 horizontalSymbols 系統性能更好
- **兼容性強**：不依賴複雜的滑動手勢，適合所有用戶

---

### � 階段3：基礎配色系統 (優先度：高) ✅ **已完成**
**目標：** 實作三種按鈕的基礎配色自訂
**預估時間：** 2-3小時
**風險：** 中等

#### 🎯 **實作方案評估**

**方案1：漸進式重構（推薦）**
- **優勢**：保持現有結構，逐步加入自訂功能
- **實作**：在 Settings.libsonnet 加入配色設定，修改 color.libsonnet 支援動態引用
- **風險**：低，不破壞現有功能
- **靈活性**：高，用戶可選擇使用預設或自訂配色

**方案2：完全重寫**
- **優勢**：架構更清晰
- **實作**：完全重新設計配色系統
- **風險**：高，可能破壞現有功能
- **靈活性**：高，但學習成本高

**🏆 採用方案1：漸進式重構**

#### 任務清單：
- [x] 3.1 在 Settings.libsonnet 加入基礎配色設定
- [x] 3.2 修改 color.libsonnet 支援動態配色引用
- [x] 3.3 實作字母鍵配色映射
- [x] 3.4 實作系統鍵配色映射
- [x] 3.5 實作主題色鍵配色映射
- [x] 3.6 測試配色變更效果
- [x] 3.7 **🆕 加入滑動提示文字配色與字號**
- [x] 3.8 **🆕 加入按鍵文字配色與字號（ABCD字母、空白鍵文字）**
- [x] 3.9 **🆕 加入數字鍵配色與字號**
- [x] 3.10 **🆕 加入系統功能鍵文字配色與字號**
- [x] 3.11 **🆕 加入工具列文字和符號配色與字號**
- [x] 3.12 **🆕 修改 fontSize.libsonnet 支援自訂字號**
- [x] 3.13 **🆕 修改 color.libsonnet 支援所有文字顏色**
- [x] 3.14 **🆕 修改各鍵盤檔案應用自訂顏色**

#### 🏆 **最終成果**：

**功能完整性**：
- ✅ **三種按鈕類型配色**：字母鍵、系統鍵、主題色鍵完全支援自訂
- ✅ **亮暗主題支援**：light 和 dark 主題都支援獨立配色
- ✅ **開關控制**：`enableCustomColors` 可完全控制是否使用自訂配色
- ✅ **向後兼容**：關閉自訂配色時完全恢復原版顏色
- ✅ **安全預設值**：使用 `safeGetColor` 函數確保總是有有效顏色值

**技術實現**：
```jsonnet
// 核心技術架構
local safeGetColor = function(buttonType, theme, colorType, state, defaultColor)
  local customColor = getButtonColor(buttonType, theme, colorType, state);
  if customColor != null then customColor else defaultColor;

// 動態配色應用
'字母键背景颜色-普通': safeGetColor('alphabeticButton', 'light', 'background', 'normal', '#FFFFFF'),
'功能键背景颜色-普通': safeGetColor('systemButton', 'light', 'background', 'normal', '#979faf80'),
'enter键背景(蓝色)': safeGetColor('colorButton', 'light', 'background', 'normal', '#979faf80'),

// 字體配色應用
'按键前景颜色': getKeyTextColor('light', 'primary', '#000000'),        // 字母鍵、數字鍵文字色
'空白键文字颜色': getKeyTextColor('light', 'secondary', '#666666'),     // 空白鍵提示文字色
'系统功能键文字颜色': getSystemKeyTextColor('light', 'normal', '#000000'),  // 系統功能鍵文字色
'数字键文字颜色': getNumericKeysTextColor('light', '#000000'),          // 數字鍵文字色
'上滑提示文字颜色': getSwipeTextColor('light', 'upSwipe', '#666666'),    // 上滑提示文字色
'下滑提示文字颜色': getSwipeTextColor('light', 'downSwipe', '#666666'),  // 下滑提示文字色
'toolbar文字按键颜色': getToolbarTextColor('light', 'textColor', '#000000'),  // 工具列文字色
'toolbar符号按键颜色': getToolbarTextColor('light', 'symbolColor', '#666666'), // 工具列符號色
```

**用戶體驗**：
- **簡單易用**：只需修改 Settings.libsonnet 中的顏色值
- **即時生效**：修改後執行 `python3 build.py` 立即看到效果
- **完全控制**：支援 HEX 和 RGBA 格式，包含透明度
- **安全可靠**：錯誤配色會自動回退到預設值

#### 基礎配色結構：
```jsonnet
customColors: {
  // 啟用自訂配色（false = 使用原版配色）
  enableCustomColors: true,
  
  // 三種按鈕類型配色
  alphabeticButton: {
    light: {
      background: { normal: '#FFFFFF', highlight: '#ABB0BA' },
      foreground: { normal: '#000000', highlight: '#000000' },
    },
    dark: {
      background: { normal: '#D1D1D165', highlight: '#D1D1D624' },
      foreground: { normal: '#FFFFFF', highlight: '#FFFFFF' },
    },
  },
  
  // 滑動提示文字配色與字號
  swipeText: {
    light: { upSwipe: '#666666', downSwipe: '#666666' },
    dark: { upSwipe: '#CCCCCC', downSwipe: '#CCCCCC' },
    fontSize: 12,
  },
  
  // 鍵盤主要文字配色與字號
  keyText: {
    light: { primary: '#000000', secondary: '#666666' },
    dark: { primary: '#FFFFFF', secondary: '#CCCCCC' },
    primaryFontSize: 18,
    secondaryFontSize: 14,
  },
  
  // 系統功能鍵文字配色與字號
  systemKeyText: {
    light: { normal: '#000000', highlight: '#000000' },
    dark: { normal: '#FFFFFF', highlight: '#FFFFFF' },
    fontSize: 16,
  },
  
  // 數字鍵配色與字號（純數字鍵盤）
  numericKeys: {
    light: { numbers: '#000000' },
    dark: { numbers: '#FFFFFF' },
    numberFontSize: 24,
  },
}
```

#### 驗收標準：
- [x] 修改配色後編譯可看到變化
- [x] 三種按鈕類型顏色正確應用
- [x] 正常和按下狀態顏色正確
- [x] 亮色和暗色主題都支援自訂
- [x] 可透過 enableCustomColors 開關控制
- [x] **🆕 滑動提示文字顏色和字號正確應用**
- [x] **🆕 按鍵文字（ABCD、空白鍵）顏色和字號正確應用**
- [x] **🆕 系統功能鍵（返回、換行等）文字顏色和字號正確應用**
- [x] **🆕 數字鍵文字顏色和字號正確應用**
- [x] **🆕 工具列文字和符號顏色、字號正確應用**
- [x] **編譯測試**：24個 YAML 檔案全部成功生成
- [x] **功能測試**：自訂配色正確應用到生成的皮膚檔案
- [x] **開關測試**：enableCustomColors: false 時恢復原版配色

#### 檔案異動：
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/Settings.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/color.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/fontSize.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/toolbar.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/swipeStyles.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/keyboard/alphabetic_26.jsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/keyboard/numeric_9_portrait.jsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/utils.libsonnet`

---

### 🟢 階段4：完整配色系統 (優先度：中) ✅ **已完成**
**目標：** 加入陰影、邊緣、提示框等完整配色，包含工具列字體顏色和字號
**預估時間：** 2-3小時
**風險：** 中等

#### 🎯 **實作方案評估**

**方案1：漸進式重構（推薦）**
- **優勢**：基於階段3的基礎，逐步擴展配色項目
- **實作**：在現有 customColors 結構中加入更多配色選項
- **風險**：低，延續階段3的成功經驗
- **靈活性**：極高，用戶可精細控制每個視覺元素

**🏆 採用方案1：漸進式重構**

#### 任務清單：
- [x] 4.1 加入陰影色配色設定
- [x] 4.2 加入底部邊緣色配色設定
- [x] 4.3 加入提示框配色設定
- [x] 4.4 加入鍵盤背景配色設定
- [x] 4.5 加入工具列配色設定
- [x] 4.6 加入候選字配色設定
- [x] 4.7 測試完整配色效果
- [x] 4.8 **🆕 修正配色系統結構**
- [x] 4.9 **🆕 加入工具列字體顏色和字號設定**

#### 🏆 **最終成果**：

**功能完整性**：
- ✅ **六大實用配色分類**：底部邊緣、候選字、工具列、數字鍵盤符號區、符號鍵盤、面板
- ✅ **工具列字體配色與字號**：中/英、簡/繁文字色、符號色、字號完全可自訂
- ✅ **智能排除圖片控制項目**：氣泡提示框和長按選單由 hint.png 圖片控制，不包含在自訂配色中
- ✅ **鍵盤背景移至基礎配色**：鍵盤背景配色移至階段3基礎配色系統
- ✅ **移除無用配色項目**：移除工具列滑動字符配色（工具列不滑動）
- ✅ **數字鍵盤配色優化**：數字按鈕跟隨字母鍵配色，僅左側符號區(@%-+)可自訂
- ✅ **亮暗主題支援**：所有配色項目都支援 light 和 dark 主題獨立設定
- ✅ **智能開關控制**：`enableAdvancedColors` 可完全控制進階配色
- ✅ **向後兼容**：關閉進階配色時完全恢復原版顏色
- ✅ **安全架構**：使用 `getAdvancedColor` 和 `getKeyboardColor` 函數確保穩定性

**🆕 工具列字體配色與字號系統**：
```jsonnet
// 工具列配色與字號
toolbar: {
  light: {
    buttonColor: '#262830',     // 工具列按鈕色
    textColor: '#000000',       // 工具列文字色（中/英、簡/繁）
    symbolColor: '#666666',     // 工具列符號色
  },
  dark: {
    buttonColor: '#8E8D96',     // 工具列按鈕色
    textColor: '#FFFFFF',       // 工具列文字色（中/英、簡/繁）
    symbolColor: '#CCCCCC',     // 工具列符號色
  },
  textFontSize: 14,             // 工具列文字大小（中/英、簡/繁）
  symbolFontSize: 16,           // 工具列符號大小
},
```

**技術實現**：
```jsonnet
// 核心技術架構
local getAdvancedColor = function(colorCategory, theme, colorType, defaultColor)
  if settings.advancedColors.enableAdvancedColors then
    local advancedColor = settings.advancedColors[colorCategory][theme][colorType];
    if advancedColor != null then advancedColor else defaultColor
  else
    defaultColor;

local getKeyboardColor = function(theme, defaultColor)
  if settings.customColors.enableCustomColors then
    local customColor = settings.customColors.keyboard[theme].background;
    if customColor != null then customColor else defaultColor
  else
    defaultColor;

// 動態進階配色應用
'底边缘颜色-普通': getAdvancedColor('lowerEdge', 'light', 'normal', '#9a9c9a'),
'toolbar按键颜色': getAdvancedColor('toolbar', 'light', 'buttonColor', '#262830'),
'toolbar文字颜色': getAdvancedColor('toolbar', 'light', 'textColor', '#000000'),
'toolbar符号颜色': getAdvancedColor('toolbar', 'light', 'symbolColor', '#666666'),
'键盘背景颜色': getKeyboardColor('light', '#D0D3DA01'),
```

**配色分類架構**：
1. **lowerEdge**: 按鍵底部邊緣顏色（正常、按下狀態）
2. **candidate**: 候選字顏色（選中/未選中文字、背景）
3. **toolbar**: 工具列顏色（按鈕色、文字色、符號色、字號）
4. **numericSymbols**: 數字鍵盤符號區顏色（左側@%-+符號區域）
5. **symbolic**: 符號鍵盤顏色（文字、背景、邊緣）
6. **panel**: 面板浮動鍵盤顏色（前景色）

**🚫 不包含的項目（由圖片控制）**：
- **callout**: 氣泡提示框（使用 hint.png 圖片，無法自訂顏色）
- **longPress**: 長按選單（使用 hint.png 圖片，無法自訂顏色）

**🔄 自動跟隨的項目**：
- **numeric**: 數字鍵盤數字按鈕（跟隨字母鍵配色）

**🗑️ 移除的項目**：
- **swipeCharacter**: 滑動字符配色（工具列不滑動，無需此配色）

**用戶體驗**：
- **精細控制**：每個視覺元素都可以獨立自訂
- **工具列完整控制**：中/英、簡/繁文字色、符號色、字號都可自訂
- **即時生效**：修改後執行 `python3 build.py` 立即看到效果
- **完全控制**：支援 HEX 和 RGBA 格式，包含透明度
- **雙重開關**：基礎配色和進階配色可以獨立控制
- **智能分類**：基礎配色包含鍵盤背景，進階配色包含細節項目

#### 🆕 **階段4修正內容**：

**問題1：配色項目分類不當**
- **修正前**：鍵盤背景放在進階配色中
- **修正後**：鍵盤背景移至基礎配色（階段3），因為它是基礎視覺元素

**問題2：包含無法自訂的項目**
- **修正前**：包含 callout 和 longPress 配色設定
- **修正後**：移除這些項目，因為它們由 hint.png 圖片控制，無法透過顏色自訂

**問題3：包含無用的配色項目**
- **修正前**：包含工具列 swipeCharacter 配色
- **修正後**：移除此項目，因為工具列不滑動，不需要滑動字符配色

**問題4：數字鍵盤配色不明確**
- **修正前**：數字鍵盤配色不清楚範圍
- **修正後**：明確說明數字按鈕跟隨字母鍵配色，僅左側符號區(@%-+)可自訂

**問題5：工具列字體配色缺失**
- **修正前**：工具列只有按鈕色，缺少文字色和符號色
- **修正後**：加入 textColor（中/英、簡/繁）、symbolColor、textFontSize、symbolFontSize

#### 完整配色項目：
- ✅ 底部邊緣色 (lowerEdge) - 按鍵底部邊緣
- ✅ 候選字色 (candidate) - 候選字文字和背景
- ✅ 工具列色 (toolbar) - 工具列按鈕、文字、符號、字號
- ✅ 數字鍵盤符號區色 (numericSymbols) - 左側@%-+符號區域
- ✅ 符號鍵盤色 (symbolic) - 符號鍵盤各區域
- ✅ 面板色 (panel) - 面板浮動鍵盤

#### 驗收標準：
- [x] 所有配色項目可正確自訂
- [x] 視覺效果符合預期
- [x] 配色組合協調美觀
- [x] **🆕 工具列文字色和符號色正確應用**
- [x] **🆕 工具列字號設定正確生效**
- [x] **編譯測試**：24個 YAML 檔案全部成功生成
- [x] **功能測試**：進階配色正確應用到生成的皮膚檔案
- [x] **開關測試**：enableAdvancedColors: false 時恢復原版配色
- [x] **雙重控制**：基礎配色和進階配色可以獨立開關
- [x] **🆕 結構修正**：配色項目分類正確，無無效項目
- [x] **🆕 鍵盤背景**：鍵盤背景配色正確移至基礎配色系統

#### 檔案異動：
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/Settings.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/color.libsonnet`

---

### 🟢 階段5：優化與完善 (優先度：低) ✅ **已完成**
**目標：** 優化使用者體驗和程式碼品質，完善字體配色說明
**預估時間：** 1-2小時
**風險：** 低

#### 任務清單：
- [x] 5.1 加入詳細的設定說明註解
- [x] 5.2 提供多套預設配色方案範例
- [x] 5.3 優化程式碼結構和命名
- [x] 5.4 加入錯誤處理和預設值
- [x] 5.5 撰寫使用說明文件
- [x] 5.6 **🆕 整理Settings.libsonnet結構**
- [x] 5.7 **🆕 優化註解說明和範例**
- [x] 5.8 **🆕 添加透明度使用說明**
- [x] 5.9 **🆕 完善字體配色與字號說明**

#### 🏆 **最終成果**：

**Settings.libsonnet 結構優化**：
- ✅ **清晰的區塊劃分**：鍵盤佈局 → 工具列配置 → 滑動功能 → 基礎配色 → 進階配色
- ✅ **移除階段標記**：去除「階段3」「階段4」等開發標記，改為「基礎配色」「進階配色」
- ✅ **優化註解說明**：明確說明需要取消註解「//」才能使用範例設定
- ✅ **實用範例設定**：將範例設定改為false（關閉功能），因為預設是開啟
- ✅ **配色說明重組**：將配色說明移至配色區塊後方，更符合邏輯順序

**字體配色與字號完善說明**：
- ✅ **字號設定說明**：字號單位為 pt（點），建議範圍 10-30pt
- ✅ **常用字號對照**：12（小）、14（中）、16（中大）、18（大）、24（特大）
- ✅ **字體配色分類**：主要文字（字母鍵）vs 次要文字（空白鍵、滑動提示）
- ✅ **工具列字體說明**：中/英、簡/繁文字 vs 符號的顏色和字號區別
- ✅ **數字鍵字體說明**：數字 vs 字母（2ABC等）的顏色和字號區別

**透明度使用說明**：
- ✅ **詳細透明度對照表**：00（完全透明）到 FF（完全不透明）
- ✅ **常用透明度值**：10（6%）、20（12%）、40（25%）、80（50%）、C0（75%）、E0（88%）
- ✅ **實際範例標註**：在配色設定中標註透明度值，如 `#D1D1D165`（65為透明度）

**工具列配置優化**：
- ✅ **按鈕編號重新分類**：常用功能（0-9）、編輯功能（10-19）、其他設定（20-25）
- ✅ **多種配置範例**：編輯功能版、系統功能版、混合配置版、極簡配置版
- ✅ **清晰的按鈕對照表**：每個編號對應的功能一目了然

**滑動功能說明優化**：
- ✅ **明確的使用說明**：「取消註解『//』即可使用」
- ✅ **實用的範例場景**：關閉所有滑動、僅保留下滑、僅保留長按等
- ✅ **分行控制說明**：清楚說明每行包含哪些按鍵

**配色系統完善**：
- ✅ **顏色格式說明**：HEX格式、RGBA格式、透明度值對照
- ✅ **配色分類說明**：基礎配色vs進階配色的區別和用途
- ✅ **字體與字號配置說明**：詳細說明每個字體配置項目的用途和建議值
- ✅ **實用配色範例**：護眼綠色、深色藍調、高對比、半透明、大字體等主題範例
- ✅ **不可自訂項目說明**：明確說明哪些項目由圖片控制，無法自訂

**🆕 字體配色與字號配置完整說明**：
```jsonnet
# 【字體與字號配置】
# • swipeText.fontSize：滑動提示文字大小
# • keyText.primaryFontSize：字母鍵和數字鍵文字大小（A-Z, 0-9）
# • keyText.secondaryFontSize：空白鍵提示文字大小
# • systemKeyText.fontSize：系統功能鍵文字大小（返回、換行、同音、選定、搜尋等）
# • numericKeys.numberFontSize：數字鍵字體大小（0-9）
# • toolbar.textFontSize：工具列文字大小（中/英、簡/繁）
# • toolbar.symbolFontSize：工具列符號大小

# 【實用配色範例】
# 大字體主題：
#   primaryFontSize: 22, secondaryFontSize: 18, systemKeyText.fontSize: 20, numberFontSize: 28
# 護眼綠色主題：
#   字母鍵背景 '#E8F5E8'，系統鍵背景 '#D4F1D4'，文字色 '#2E7D32'
# 深色藍調主題：
#   字母鍵背景 '#2C3E50'，文字色 '#ECF0F1'，滑動提示 '#BDC3C7'
```

#### 使用者體驗改善：
- **一目了然的結構**：按功能分類，邏輯清晰
- **詳細的說明註解**：每個設定都有清楚的說明
- **豐富的範例配置**：提供多種實用的配置範例
- **完整的字體說明**：字體顏色、字號、用途都有詳細說明
- **完整的使用指南**：從基礎到進階的完整說明

#### 驗收標準：
- [x] Settings.libsonnet 結構清晰易懂
- [x] 註解說明詳細完整
- [x] 範例配置實用有效
- [x] 透明度說明清楚明確
- [x] **🆕 字體配色說明完整詳細**
- [x] **🆕 字號設定說明清楚實用**
- [x] **🆕 工具列字體配置說明完善**
- [x] **編譯測試**：24個 YAML 檔案全部成功生成
- [x] **結構優化**：去除開發標記，改為用戶友好的命名
- [x] **說明完善**：每個功能都有詳細的使用說明

#### 檔案異動：
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/Settings.libsonnet`

---

### 🟢 階段6：Jsonnet 語法錯誤修復 (優先度：最高) ✅ **已完成**
**目標：** 修復 Jsonnet 編譯錯誤，確保皮膚可以正常編譯
**預估時間：** 0.5-1小時
**風險：** 低

#### 任務清單：
- [x] 6.1 修復 hintSymbolsData.libsonnet 中的錯誤轉義字符
- [x] 6.2 修復 color.libsonnet 中的重複欄位名稱
- [x] 6.3 測試 Jsonnet 編譯成功
- [x] 6.4 驗證字體顏色和字號系統正常工作
- [x] 6.5 **🆕 移除不必要的工具列按鈕色配置**
- [x] 6.6 **🆕 修復配色系統架構混亂問題**

#### 🏆 **修復內容**：

**問題1：轉義字符語法錯誤**
- **檔案**：`hintSymbolsData.libsonnet` 第147行
- **錯誤**：`{ action: { symbol: '\\' }, label: { text: '\\' } }`
- **修正**：`{ action: { symbol: '\\\\' }, label: { text: '\\\\' } }`
- **原因**：Jsonnet 中表示單個反斜線需要四個反斜線（`\\\\`）

**問題2：重複欄位名稱**
- **檔案**：`color.libsonnet` 第126行和第129行
- **錯誤**：`按键前景颜色` 欄位重複定義
- **修正**：將面板配色欄位重命名為 `面板按键前景颜色`
- **原因**：Jsonnet 不允許同一物件中有重複的欄位名稱

**🆕 問題3：不必要的工具列按鈕色配置**
- **檔案**：`Settings.libsonnet`、`color.libsonnet`、`toolbar-en.libsonnet`
- **問題**：工具列按鈕背景是透明的，`buttonColor` 配置沒有實際作用
- **修正**：移除 `toolbar.buttonColor` 配置，只保留 `textColor` 和 `symbolColor`
- **原因**：工具列按鈕使用透明背景（`#00000001`），只有文字和符號需要顏色配置

**🆕 問題4：數字鍵盤符號區缺少字號配置**
- **檔案**：`Settings.libsonnet`、`fontSize.libsonnet`
- **問題**：數字鍵盤符號區（@%-+）有顏色配置但字號是固定值
- **修正**：加入 `numericSymbols.fontSize` 配置，支援自訂字號
- **原因**：用戶應該能夠調整符號區的字體大小以配合整體設計

**🆕 問題5：配色系統架構混亂**
- **檔案**：`Settings.libsonnet`、`fontSize.libsonnet`、`color.libsonnet`
- **問題1**：符號鍵盤包含無用的 `unselectedText` 配置，實際只使用 `selectedText`
- **問題2**：數字鍵盤符號區實際使用主要按鍵文字色（`按键前景颜色`），不是獨立的 `collection前景颜色`
- **問題3**：工具列字號預設值不正確，應該是 20pt 而不是 14pt/16pt
- **修正1**：移除無用的 `unselectedText` 配置
- **修正2**：移除無用的 `numericSymbols` 配色，說明數字鍵盤符號區使用 `keyText.primary`
- **修正3**：修正工具列字號預設值為 20pt（符合原主題）
- **原因**：配色系統應該反映實際使用情況，預設值應該與原主題一致

#### 技術實現：
```jsonnet
// 修復前（錯誤）
{ action: { symbol: '\\' }, label: { text: '\\' } }  // 語法錯誤
'按键前景颜色': getAdvancedColor('panel', 'light', 'foreground', '#000000'),  // 重複欄位
'按键前景颜色': getKeyTextColor('light', 'primary', '#000000'),              // 重複欄位
toolbar: { buttonColor: '#262830' },  // 不必要的配置
symbolic: { unselectedText: '#000000' },  // 無用配置（實際不被使用）
'collection前景颜色': getAdvancedColor('symbolic', 'light', 'leftBackground'),  // 錯誤引用

// 修復後（正確）
{ action: { symbol: '\\\\' }, label: { text: '\\\\' } }  // 正確轉義
'面板按键前景颜色': getAdvancedColor('panel', 'light', 'foreground', '#000000'),  // 重命名
'按键前景颜色': getKeyTextColor('light', 'primary', '#000000'),                // 保持原名
toolbar: { textColor: '#000000', symbolColor: '#666666' },  // 只保留必要配置
symbolic: { selectedText: '#000000' },      // 只保留實際使用的配色
// 數字鍵盤符號區使用 keyText.primary，無需獨立配色
'toolbar按键前景文字大小': getToolbarFontSize('textFontSize', 20),  // 正確預設值
```

#### 驗收標準：
- [x] Jsonnet 編譯無語法錯誤
- [x] main.jsonnet 可以成功編譯
- [x] 字體顏色和字號系統正常工作
- [x] 所有自訂配色功能正常
- [x] 工具列按鈕配置正常
- [x] **🆕 配色系統架構修正，移除無用配置**
- [x] **🆕 符號鍵盤字號支援自訂**

#### 檔案異動：
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/hintSymbolsData.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/color.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/toolbar-en.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/lib/fontSize.libsonnet`
- 修改：`元書-蝦米方案/皮膚/蝦米輸入法/jsonnet/Settings.libsonnet`

---

### 🟡 階段7：GitHub Pages 皮膚配置器 (優先度：中) 🆕
**目標：** 建立網頁版皮膚配置器，讓用戶透過視覺化介面自訂皮膚
**預估時間：** 1-2週
**風險：** 中等

#### 🎯 GitHub Pages 皮膚配置器可行性評估

##### ✅ 高度可行！理由如下：

**技術架構完全可行**
- **GitHub Pages**：支援靜態網頁，完全免費
- **前端技術**：HTML + CSS + JavaScript 即可實現
- **無需後端**：純前端生成檔案，無伺服器成本
- **檔案下載**：瀏覽器原生支援檔案下載功能

**現有基礎良好**
- **Settings.libsonnet 結構化**：已經有清晰的設定架構
- **Jsonnet 格式簡單**：容易用 JavaScript 生成
- **皮膚檔案結構固定**：可以預先準備模板

#### 🛠️ 技術實現方案

**方案B：完整皮膚生成器（推薦）**
```
網頁功能：
├── 視覺化配置介面
│   ├── 即時預覽 (模擬鍵盤外觀)
│   ├── 拖拉式按鈕配置
│   ├── 調色盤 + 即時顏色預覽
│   └── 設定匯入/匯出
├── 檔案生成引擎
│   ├── Settings.libsonnet 生成
│   ├── 整合 Jsonnet 編譯器 (WASM)
│   └── 完整皮膚檔案包生成
└── 一鍵下載
    ├── .cskin 檔案 (可直接安裝)
    ├── 完整資料夾結構
    └── 安裝說明文件
```

#### 🎨 使用者體驗設計

**配置流程：**
1. **選擇基礎模板** → 蝦米右手版 / 左手版 / 自訂
2. **鍵盤佈局設定** → 空白鍵大小、按鈕間距
3. **工具列配置** → 拖拉10個按鈕位置
4. **滑動控制** → 分行精細控制開關
5. **顏色主題** → 調色盤 + 預設主題
6. **即時預覽** → 看到實際效果
7. **一鍵下載** → 完整皮膚包

**介面設計概念：**
```
┌─────────────────────────────────────────┐
│ 蝦米輸入法皮膚配置器                      │
├─────────────────────────────────────────┤
│ [預覽區域]          │ [設定面板]          │
│ ┌─────────────────┐ │ ┌─────────────────┐ │
│ │ 鍵盤即時預覽      │ │ ├ 鍵盤佈局        │ │
│ │ Q W E R T Y U I │ │ │ ├ 工具列配置      │ │
│ │ A S D F G H J K │ │ │ ├ 滑動控制        │ │
│ │ Z X C V B N M   │ │ │ ├ 顏色主題        │ │
│ │ [工具列預覽]      │ │ │ └ 進階設定        │ │
│ └─────────────────┘ │ └─────────────────┘ │
│                     │ [下載按鈕]          │
└─────────────────────────────────────────┘
```

#### 📊 可行性評估結果

| 功能模組 | 技術難度 | 實作時間 | 可行性 |
|---------|---------|---------|--------|
| 基礎網頁架構 | 低 | 1-2天 | ✅ 100% |
| 設定介面 | 中 | 3-4天 | ✅ 95% |
| 調色盤整合 | 低 | 1天 | ✅ 100% |
| 即時預覽 | 中 | 2-3天 | ✅ 90% |
| Jsonnet 編譯 | 高 | 2-3天 | ✅ 85% |
| 檔案打包下載 | 中 | 1-2天 | ✅ 95% |
| GitHub Pages 部署 | 低 | 0.5天 | ✅ 100% |

#### 🎯 建議實作階段

**階段1：基礎版本（MVP）**
- Settings.libsonnet 生成器
- 基本調色盤
- 檔案下載功能

**階段2：進階版本**
- 即時預覽功能
- 拖拉式配置
- 完整皮膚生成

**階段3：完善版本**
- 預設主題庫
- 匯入/匯出功能
- 使用說明整合

#### 🚀 額外優勢

1. **零成本維護**：GitHub Pages 免費託管
2. **全球可訪問**：CDN 加速，世界各地都能使用
3. **版本控制**：配置器本身也用 Git 管理
4. **社群貢獻**：其他開發者可以提交 PR 改進
5. **SEO 友好**：容易被搜尋引擎找到

#### 🎉 結論

**高度可行！** 這個想法非常棒，不僅技術上完全可行，而且會大大提升用戶體驗。建議採用方案B（完整皮膚生成器），讓用戶可以：

1. **視覺化配置** → 不需要理解 Jsonnet 語法
2. **即時預覽** → 立即看到配置效果  
3. **一鍵下載** → 直接獲得可用的皮膚檔案
4. **零技術門檻** → 普通用戶也能輕鬆自訂

這將是 Hamster 輸入法生態系統中的一個重要工具！

#### 任務清單：
- [ ] 7.1 建立 GitHub Pages 專案架構
- [ ] 7.2 實作基礎配置介面
- [ ] 7.3 整合調色盤組件
- [ ] 7.4 實作 Settings.libsonnet 生成器
- [ ] 7.5 加入即時預覽功能
- [ ] 7.6 整合 Jsonnet 編譯器 (WASM)
- [ ] 7.7 實作完整皮膚檔案生成
- [ ] 7.8 加入檔案打包下載功能
- [ ] 7.9 部署到 GitHub Pages
- [ ] 7.10 撰寫使用說明文件

---

## 檔案結構規劃

```
元書-蝦米方案/皮膚/蝦米輸入法/
├── jsonnet/
│   ├── Settings.libsonnet          # 新增：使用者設定檔
│   ├── lib/
│   │   ├── toolbar.libsonnet       # 修改：工具列邏輯
│   │   ├── color.libsonnet         # 修改：改為動態引用
│   │   ├── fontSize.libsonnet      # 修改：支援自訂字號
│   │   └── hintSymbolsData.libsonnet # 修改：修復語法錯誤
│   └── main.jsonnet                # 修改：引用 Settings
```

---

## 技術風險評估

### 高風險項目：
- **Jsonnet 語法錯誤** - ✅ 已解決：修復轉義字符和重複欄位問題

### 中風險項目：
- **按鈕編號系統** - ✅ 已完成：建立完整的映射表
- **空白佔位符** - ✅ 已完成：正確處理對齊邏輯
- **配色系統重構** - ✅ 已完成：確保所有顏色變數正確映射

### 低風險項目：
- **設定檔建立** - ✅ 已完成：相對簡單的檔案操作
- **註解和文件** - ✅ 已完成：不影響核心功能

---

## 測試檢查清單

### 功能測試：
- [x] 完全自訂工具列正常運作
- [x] 按鈕對齊位置正確
- [x] 配色變更立即生效
- [x] 所有按鈕功能正常
- [x] 字體顏色和字號正確應用
- [x] Jsonnet 編譯無錯誤

### 相容性測試：
- [x] 直向模式正常顯示
- [x] 橫向模式正常顯示
- [x] 不同按鈕數量正常處理
- [x] 編譯無錯誤警告
- [x] 所有皮膚檔案正確生成

### 使用者體驗測試：
- [x] 設定檔易於理解和修改
- [x] 配色效果符合預期
- [x] 字體大小調整正常
- [x] 工具列配置直觀易用

---

## 注意事項

1. **備份重要性**：每個階段開始前都要備份現有檔案
2. **漸進式開發**：每完成一個階段都要測試確認無誤
3. **向後相容**：確保不破壞現有功能
4. **使用者友善**：設定檔要有清楚的說明和範例

---

## 聯絡資訊
- 開發者：Kiro AI Assistant
- 專案路徑：`元書-蝦米方案/皮膚/蝦米：慣用右手(空白增大)/`
- 最後更新：2025-01-29

---

**專案狀態：✅ 核心功能已完成**
- ✅ 完全自訂工具列系統
- ✅ 完整字體顏色與字號系統  
- ✅ 基礎與進階配色系統
- ✅ Jsonnet 語法錯誤修復
- 🟡 GitHub Pages 皮膚配置器（規劃中）

**下一步行動：考慮實作 GitHub Pages 皮膚配置器**